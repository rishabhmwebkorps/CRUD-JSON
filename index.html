<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Document</title>
</head>

<body>
  <form id="main-form">
    <label>First Name</label>
    <input type="text" name="name" id="name">
    <br>
    <label>Email</label>
    <input type="email" name="email" id="email" required>
    <br>
    <label>Phone</label>
    <input type="number" name="phone" id="phone">
    <label>Image</label>
    <input type="file" name="file" id="fileInput">
    <br>
    <button type="submit">Submit</button>
  </form>

  <h1>Details Card</h1>
  <div id="detailslist">

  </div>

  <form id="editDetails" style="display:none;">

    <input id="edit-id" type="hidden">
    <label>First Name</label>
    <input type="text" name="editname" id="editname">
    <br>
    <label>Email</label>
    <input type="email" name="editemail" id="editemail">
    <br>
    <label>Phone</label>
    <input type="number" name="editphone" id="editphone">
    <br>
    <button type="submit">Save Edit Changes</button>

    <div onclick= onCancel() class="Cancel">Cancel</div>
  </form>

  <script>
    document.getElementById('main-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      function detailsId() {
        const min = 1000;
        const max = 5000;
        return String(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      const randomId = detailsId();
      const fileInput = document.getElementById('fileInput').files[0];

      if (fileInput) {
        const reader = new FileReader();

        reader.onload = function (event) {
          const fileContent = event.target.result;

          const formData = {
            id: randomId,
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            file: fileContent,
          };

          submitData(formData);
        };

        reader.onerror = function () {
          console.error('Error reading file');
        };

        reader.readAsDataURL(fileInput); 
      } 


      async function submitData(formData) {

        await fetch('http://localhost:3000/details', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        getDetails();
        alert('Success')

      }
    });

    async function getDetails() {
      try {
        const response = await fetch(`http://localhost:3000/details`);
        const details = await response.json();
        const detailList = document.getElementById('detailslist');
        detailList.innerHTML = '';

        details.map(item => {
          const card = document.createElement('div');
          card.className = 'cardDetails';
          card.innerHTML = `
               <img src="${item.file}">
            <p> <span>Name :</span> ${item.name}</p>
            <p> <span>Email:</span> ${item.email}</p>
            <p> <span>Phone:</span> ${item.phone}</p>
     
            <button onclick="editDetails(${item.id})">Edit</button>
            <button id='delete-button' onclick="deleteDetails(${item.id})">Delete</button>
          `;
          detailList.appendChild(card);
        });
      } catch (error) {
        console.error(error, 'Error in fetch');
      }
    }

    async function deleteDetails(id) {
      console.log(id, 'delete items')
      try {
        const response = await fetch(`http://localhost:3000/details/${id}`,
          { method: 'DELETE' });

        getDetails();
      } catch (error) {
        console.error(error);
      }
    }

    async function editDetails(id) {
      try {
        const response = await fetch(`http://localhost:3000/details/${id}`);
        const detail = await response.json();

        document.getElementById('editname').value = detail.name;
        document.getElementById('editemail').value = detail.email;
        document.getElementById('editphone').value = detail.phone;
        document.getElementById('edit-id').value = detail.id;
        console.log(detail.id,'Idddddddddd');
        document.getElementById('editDetails').style.display = 'block';
      } catch (error) {
        console.error('Error in edit fetch:', error);
      }
    }

    document.getElementById('editDetails').addEventListener('submit', async function (e) {
      e.preventDefault();

      const id = document.getElementById('edit-id').value;
      const editedData = {
        name: document.getElementById('editname').value,
        email: document.getElementById('editemail').value,
        phone: document.getElementById('editphone').value,
      
      };

      await fetch(`http://localhost:3000/details/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(editedData),
      });

      document.getElementById('editDetails').style.display = 'none';
      getDetails();
    });


    function onCancel() {
      document.getElementById('editDetails').style.display = 'none';
    }
    getDetails();
  </script>
</body>

</html>